C51 COMPILER V9.60.0.0   MAIN                                                              11/09/2024 20:18:36 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OMF2 OPTIMIZE(9,SPEED) BROWSE INCDIR(.\include;.\StdDriver\inc;.\
                    -Hardware) DEBUG PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "cms8s6990.h"
   2          #include "GPIO.h"
   3          #include "delay.h"
   4          #include "SideKey.h"
   5          #include "LEDMgmt.h"
   6          #include "ADCCfg.h"
   7          #include "PinDefs.h"
   8          #include "OutputChannel.h"
   9          #include "PWMCfg.h"
  10          #include "BattDisplay.h"
  11          #include "ModeControl.h"
  12          #include "Watchdog.h"
  13          
  14          //函数声明
  15          void CheckNTCStatus(void);
  16          void SleepMgmt(void);
  17          void DisplayErrorTIMHandler(void);
  18          void ThermalCalcProcess(void);
  19          void OutputFaultDetect(void);
  20          void InputFaultDetect(void);
  21          
  22          //主函数
  23          void main()
  24            {
  25   1        //时钟初始化
  26   1        delay_init();  //延时函数初始化
  27   1        SetSystemHBTimer(1);//启用系统心跳8Hz定时器 
  28   1        //初始化外设
  29   1        CheckIfHBTIMIsReady();//检查系统心跳定时器是否已激活
  30   1        LED_Init(); //初始化侧按LED
  31   1        ADC_Init(); //初始化ADC
  32   1        CheckNTCStatus(); //检查NTC状态
  33   1        ModeFSMInit(); //初始化挡位状态机
  34   1        SideKeyInit(); //侧按初始化
  35   1        PWM_Init(); //启动PWM定时器 
  36   1        OutputChannel_Init(); //启动输出通道  
  37   1        OutputChannel_TestRun(); //输出通道试运行
  38   1        DisplayVBattAtStart(); //显示输出电压
  39   1        WDog_Init(); //启动看门狗
  40   1        EnableADCAsync(); //启动ADC的异步模式提高处理速度
  41   1        //主循环  
  42   1        while(1)
  43   1          {
  44   2          //实时处理
  45   2          SystemTelemHandler();//获取电池信息 
  46   2          SideKey_LogicHandler(); //处理侧按事务
  47   2          BatteryTelemHandler(); //处理电池遥测
  48   2          ModeSwitchFSM(); //挡位状态机
  49   2          ThermalCalcProcess(); //温控PI环路计算和过热保护
  50   2          OutputChannel_Calc(); //根据电流进行输出通道控制
  51   2          PWM_OutputCtrlHandler(); //处理PWM输出事务  
  52   2          //8Hz定时处理
  53   2          if(!SysHBFlag)continue; //时间没到，跳过处理
  54   2          SysHBFlag=0;
C51 COMPILER V9.60.0.0   MAIN                                                              11/09/2024 20:18:36 PAGE 2   

  55   2          WDog_Feed(); //喂狗
  56   2          BattDisplayTIM(); //电池电量显示TIM
  57   2          LEDControlHandler(); //侧按指示LED控制函数
  58   2          ModeFSMTIMHandler();//挡位状态机所需的软件定时器处理
  59   2          HoldSwitchGearCmdHandler(); //长按换挡
  60   2          DisplayErrorTIMHandler(); //故障代码显示
  61   2          MoonConfigHandler(); //月光配置功能
  62   2          OutputFaultDetect();//输出故障检测
  63   2          InputFaultDetect(); //输入虚接检测
  64   2          SleepMgmt(); //休眠管理
  65   2          }
  66   1        }
  67          
  68          //GPIO2中断回调处理函数
  69          void Key_IRQHandler(void)  interrupt SideKeyVector 
  70            {
  71   1        //侧按中断触发，响应中断
  72   1        if(GPIO_GetIntFlag(SideKeyGPIOG,SideKeyGPIOx))
  73   1          {
  74   2          SideKey_Int_Callback();  //进行按键响应
  75   2          GPIO_ClearIntFlag(SideKeyGPIOG,SideKeyGPIOx); //清除Flag
  76   2          }
  77   1        }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    183    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
